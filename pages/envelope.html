<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Red Envelopes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-image: url('../imgs/img-tet5.jpg');
      font-family: Arial, sans-serif;
    }

    .envelope-card {
      border: none;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      cursor: pointer;
    }

    .envelope-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .envelope-card img {
      max-width: 100%;
      height: auto;
    }

    .envelope-card img {
      transition: transform 0.3s ease-in-out;
    }

    .envelope-card img:hover {
      transform: scale(1.1);
    }

    .modal-body {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .modal-body img {
      max-height: 200px;
    }
  </style>
</head>

<body>
  <audio id="clap" src="../audio/crowd_clap.mp3"></audio>
  <audio id="sad" src="../audio/Sad Meow.mp3"></audio>
  <audio id="nit" src="../audio/Cai_Nit.mp3"></audio>

  <div class="container py-5">
    <h1 class="text-center mb-4">Lucky Money</h1>
    <div id="envelopeContainer" class="row g-4">
    </div>
  </div>

  <div class="modal fade" id="envelopeModal" tabindex="-1" aria-labelledby="envelopeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="envelopeModalLabel">Envelope Opened</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <img id="modalImage" src="" alt="Money Image" class="img-fluid mb-3">
          <p id="modalMessage"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>

    const envelopes = [
      { img: '../imgs/money/500k.jpg', message: 'You found 500K VNĐ!' },
      { img: '../imgs/money/200k.jpg', message: 'You found 200K VNĐ!' },
      { img: '../imgs/money/100k.jpg', message: 'You found 100K VNĐ!' },
      { img: '../imgs/money/50k.jpg', message: 'You found 50K VNĐ!' },
      { img: '../imgs/money/20k.jpg', message: 'You found 20K VNĐ!' },
      { img: '../imgs/money/10k.jpg', message: 'You found 10K VNĐ!' },
      { img: '../imgs/money/5k.jpg', message: 'You found 5K VNĐ!' },
      { img: '../imgs/money/2k.jpg', message: 'You found 2K VNĐ!' },
      { img: '../imgs/money/1k.jpg', message: 'You found 1K VNĐ!' },
      { img: '../imgs/money/5d.jpg', message: 'You found 500 VNĐ!' },
      { img: '../imgs/money/nit.jpg', message: 'Còn cái Nịt!' }
    ];

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function generateEnvelopes() {
      const container = document.getElementById('envelopeContainer');
      container.innerHTML = '';

      const shuffledEnvelopes = shuffleArray([...envelopes]).slice(0, 6);

      shuffledEnvelopes.forEach((envelope, index) => {
        const col = document.createElement('div');
        col.className = 'col-md-4 col-lg-2';

        col.innerHTML = `
        <div class="envelope-card text-center" id="envelope-${index}">
          <img src="../imgs/red_envelope.png" alt="Envelope ${index + 1}" onclick="openEnvelope(${index})">
        </div>
      `;
        container.appendChild(col);
      });

      window.shuffledEnvelopes = shuffledEnvelopes;
    }

    function disableEnvelopes() {
      const envelopeElements = document.querySelectorAll('.envelope-card img');
      envelopeElements.forEach(img => {
        img.onclick = null;
        img.style.cursor = 'not-allowed';
      });
    }

    let envelopeOpened = false;
    function openEnvelope(index) {
      if (envelopeOpened) return;
      envelopeOpened = true;

      const envelopeData = window.shuffledEnvelopes[index];
      const envelopeElement = document.getElementById(`envelope-${index}`).querySelector('img');

      envelopeElement.src = envelopeData.img;

      document.getElementById('modalImage').src = envelopeData.img;
      document.getElementById('modalMessage').innerText = envelopeData.message;

      const highValueKeywords = ['500K', '200K', '100K', '50K', '20K', '10K'];
      const isNit = envelopeData.message.includes('Nịt');
      const isHighValue = highValueKeywords.some(keyword => envelopeData.message.includes(keyword));

      if (isHighValue) {
        document.getElementById('clap').play();
      } else if (isNit) {
        document.getElementById('nit').play();
      }
      else{
        document.getElementById('sad').play();
      }

      const modal = new bootstrap.Modal(document.getElementById('envelopeModal'));
      modal.show();

      disableEnvelopes();
    }

    function preloadImages() {
      envelopes.forEach(envelope => {
        const img = new Image();
        img.src = envelope.img;
      });
    }
    
    window.onload = () => {
      preloadImages();
      const clapSound = document.getElementById('clap');
      const sadSound = document.getElementById('sad');
      const nitSound = document.getElementById('nit');
      clapSound.load();
      sadSound.load();
      nitSound.load();
      generateEnvelopes();
    };

  </script>

</body>

</html>